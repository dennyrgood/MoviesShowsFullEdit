name: Auto Push Index
on:
  workflow_dispatch:

jobs:
  push-and-pr:
    runs-on: ubuntu-latest
    env:
      BRANCH: feature/ui-add-delay-legend-move
      COMMIT_MSG: "feat(ui): add delay after add submission, update data-view heading, move code legend under add form"
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Validate PAT (do not print it)
        env:
          PAT: ${{ secrets.GH_PUSH_PAT }}
        run: |
          status=$(curl -s -o /dev/null -w "%{http_code}" -H "Authorization: token $PAT" https://api.github.com/user)
          echo "status=$status"
          if [ "$status" != "200" ]; then
            echo "PAT validation failed (HTTP $status). Ensure the PAT has 'repo' scope and is authorized for the organization."
            exit 1
          fi

      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "actions@github.com"

      - name: Create branch from main
        run: |
          git checkout -b $BRANCH

      - name: Write new index.html
        # This writes the full updated index.html content into the workspace.
        run: |
          cat > index.html <<'EOF'
